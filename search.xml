<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>seaTunnel学习心得</title>
      <link href="/2025/04/23/seaTunnel%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97/"/>
      <url>/2025/04/23/seaTunnel%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="将Elasticsearch数据迁移到doirs"><a href="#将Elasticsearch数据迁移到doirs" class="headerlink" title="将Elasticsearch数据迁移到doirs"></a>将Elasticsearch数据迁移到doirs</h2><h2 id="一、下载SeaTunnel"><a href="#一、下载SeaTunnel" class="headerlink" title="一、下载SeaTunnel"></a>一、下载SeaTunnel</h2><h3 id="1-下载Seatunnel"><a href="#1-下载Seatunnel" class="headerlink" title="1. 下载Seatunnel"></a>1. 下载Seatunnel</h3><p>下载地址</p><blockquote><p><a href="https://seatunnel.apache.org/download/">https://seatunnel.apache.org/download/</a></p></blockquote><p>进入之后选择<code>[bin\] apache-seatunnel-2.3.10-bin.tar.gz</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> config/plugin.config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解压到相应目录</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> apache-seatunnel-2.3.10-bin.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-下载连接器插件"><a href="#2-下载连接器插件" class="headerlink" title="2. 下载连接器插件"></a>2. 下载连接器插件</h3><p>修改连接器下载配置</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> config/plugin.config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将下面部分修改</p><pre class="line-numbers language-config" data-language="config"><code class="language-config">--Connectors-v2--Connector-dorisConnector-elasticsearch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>我们只需要<code>doris</code>和<code>elasticsearch</code>, 不嫌麻烦也可以所有都安装</p><p>然后运行安装插件的命令</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./bin/install-plugin.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-安装mysql-connector的jar包"><a href="#3-安装mysql-connector的jar包" class="headerlink" title="3. 安装mysql-connector的jar包"></a>3. 安装mysql-connector的jar包</h3><p>下载方式</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://downloads.mysql.com/archives/get/p/3/file/mysql-connector-j_8.0.33-1ubuntu20.04_all.deb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>后面的<code>url</code>可在<code>mysql</code>官方</p><blockquote><p><a href="https://downloads.mysql.com/archives/c-j/">https://downloads.mysql.com/archives/c-j/</a></p></blockquote><p>选择对应的版本和系统, 然后鼠标移动至下载, 浏览器的左下角会出现一个待跳转的url,复制下来即可</p><p>解压<code>deb</code>包</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> dpkg-deb <span class="token parameter variable">-x</span> mysql-connector-j_8.0.33-1ubuntu20.04_all.deb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解压后是一个名为<code>usr</code>的文件夹</p><p>将里面的<code>jar</code>包复制到<code>seatunnel</code>的<code>lib</code>目录下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> usr/share/java/mysql-connector-j-8.0.33.jar <span class="token builtin class-name">.</span><span class="token function">sudo</span> <span class="token function">cp</span> usr/share/java/mysql-connector-java-8.0.33.jar <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面的命令是在<code>lib</code>目录下操作的,所以移动到<code>.</code>本目录即可</p><h2 id="二、配置es-to-doris-conf文件"><a href="#二、配置es-to-doris-conf文件" class="headerlink" title="二、配置es_to_doris.conf文件"></a>二、配置<code>es_to_doris.conf</code>文件</h2><p>进入config目录下创建<code>es_to_dori.conf</code>的文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> config/es_to_dori.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编写<code>conf</code>文件</p><p>可以参考<code>Apache seaTunnel</code>的官方文档</p><blockquote><p><a href="https://seatunnel.apache.org/zh-CN/docs/2.3.10/about">https://seatunnel.apache.org/zh-CN/docs/2.3.10/about</a></p></blockquote><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">env &#123;  parallelism &#x3D; 1  job.mode &#x3D; &quot;BATCH&quot;  plugin.load.mode &#x3D; &quot;CLASSLOADER&quot;  job.name &#x3D; &quot;es_to_doris&quot;&#125;source &#123;  Elasticsearch &#123;    hosts &#x3D; [&quot;ElasticsearchHost:端口号&quot;]    username&#x3D;&quot;es用户名&quot;    password&#x3D;&quot;es密码&quot;    index &#x3D; &quot;索引名&quot;    plugin_output &#x3D; &quot;es_output&quot;    scroll_time &#x3D; &quot;1m&quot;    scroll_size &#x3D; 1000    source &#x3D; [      # es中的字段,或者说需要迁移的数据名称    ]，    query &#x3D; &quot;&#123;\&quot;range\&quot;: &#123;\&quot;updateTime\&quot;: &#123;\&quot;gte\&quot;: \&quot;2025-01-01T00:00:00\&quot;, \&quot;lte\&quot;: \&quot;2025-04-20T00:00:00\&quot;&#125;&#125;&#125;&quot;  &#125;&#125;transform &#123;  JsonPath &#123;    plugin_input &#x3D; &quot;es_output&quot;    plugin_output &#x3D; &quot;output_temp&quot;    # 按照列名的方式取数据    columns &#x3D; [      &#123;        src_field &#x3D; &quot;&quot; # 源数据的字段名        path &#x3D; &quot;$[1]&quot; # 只取第二个数据        dest_field &#x3D; &quot;&quot; # 取出来后的字段名        dest_type &#x3D; &quot;STRING&quot; # 取出来后的数据类型      &#125;    ]  &#125;  Sql &#123;    plugin_input &#x3D; &quot;output_temp&quot;    # 根据上一步处理好的数据，再统一同步到doirs    plugin_output &#x3D; &quot;final_output&quot;    query &#x3D; &quot;&quot;&quot;    SELECT      *      FROM input_table    &quot;&quot;&quot;  &#125;&#125;sink &#123;  Doris &#123;    plugin_input &#x3D; &quot;final_output&quot;    fenodes &#x3D; &quot;dorisHost:端口号&quot; # 端口号我用的是部署到web上的    username &#x3D; &quot;用户名&quot;    password &#x3D; &quot;密码&quot;    database &#x3D; &quot;doris中的数据库名&quot;    table &#x3D; &quot;doris中的数据库表名&quot;    sink.label-prefix &#x3D; &quot;es_to_doris_sync&quot;    sink.enable.2pc &#x3D; &quot;false&quot;    doris.config &#x3D; &#123;      format&#x3D;&quot;json&quot;      read_json_by_line&#x3D;&quot;true&quot;    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之后运行seaTunnel</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">.&#x2F;bin&#x2F;seatunnel.sh --config .&#x2F;config&#x2F;es_to_doris.conf -m local<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个时候基本就算完成了</p><h2 id="三、设置定时增量更新"><a href="#三、设置定时增量更新" class="headerlink" title="三、设置定时增量更新"></a>三、设置定时增量更新</h2><p>需要将之前配置文件里query修改</p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim">query <span class="token operator">=</span> <span class="token string">"&#123;\"range\": &#123;\"updateTime\": &#123;\"gte\": \"$&#123;start_time&#125;\", \"lte\": \"$&#123;end_time&#125;\"&#125;&#125;&#125;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建<code>.sh</code>文件, 并编辑</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> es_to_doris_byHour.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim">#<span class="token operator">!</span><span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>bash# <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> 配置 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span># Seatunnel主目录SEATUNNEL_HOME<span class="token operator">=</span># 日志目录LOG_DIR<span class="token operator">=</span>$<span class="token punctuation">&#123;</span>SEATUNNEL_HOME<span class="token punctuation">&#125;</span><span class="token operator">/</span>es_to_doris_logs# 配置文件路径CONFIG_FILE<span class="token operator">=</span>$<span class="token punctuation">&#123;</span>SEATUNNEL_HOME<span class="token punctuation">&#125;</span><span class="token operator">/</span>config<span class="token operator">/</span>es_to_doris<span class="token operator">.</span><span class="token keyword">conf</span># 创建日志目录（如果不存在）mkdir <span class="token operator">-</span><span class="token keyword">p</span> $<span class="token punctuation">&#123;</span>LOG_DIR<span class="token punctuation">&#125;</span># 当前时间NOW<span class="token operator">=</span>$<span class="token punctuation">(</span>date <span class="token string">"+%Y%m%d_%H%M%S"</span><span class="token punctuation">)</span>LOG_FILE<span class="token operator">=</span>$<span class="token punctuation">&#123;</span>LOG_DIR<span class="token punctuation">&#125;</span><span class="token operator">/</span>es_to_doris_sync_$<span class="token punctuation">&#123;</span>NOW<span class="token punctuation">&#125;</span><span class="token operator">.</span>log# <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> 计算时间范围 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>start_time<span class="token operator">=</span>$<span class="token punctuation">(</span>date <span class="token operator">-</span><span class="token keyword">u</span> <span class="token operator">-</span><span class="token keyword">d</span> <span class="token string">"-1 hour"</span> <span class="token operator">+</span><span class="token string">"%Y-%m-%dT%H:00:00"</span><span class="token punctuation">)</span>end_time<span class="token operator">=</span>$<span class="token punctuation">(</span>date <span class="token operator">-</span><span class="token keyword">u</span> <span class="token operator">+</span><span class="token string">"%Y-%m-%dT%H:00:00"</span><span class="token punctuation">)</span># <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> 执行 Seatunnel 同步 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>echo <span class="token string">"[$(date '+%F %T')] 开始同步，本次时间段：$start_time ~ $end_time"</span> | tee <span class="token operator">-</span>a $<span class="token punctuation">&#123;</span>LOG_FILE<span class="token punctuation">&#125;</span>$<span class="token punctuation">&#123;</span>SEATUNNEL_HOME<span class="token punctuation">&#125;</span><span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>seatunnel<span class="token operator">.</span><span class="token keyword">sh</span> \  <span class="token operator">-</span><span class="token operator">-</span>config $<span class="token punctuation">&#123;</span>CONFIG_FILE<span class="token punctuation">&#125;</span> \  <span class="token operator">-</span><span class="token keyword">m</span> local \  <span class="token operator">-</span><span class="token operator">-</span>variable start_time<span class="token operator">=</span><span class="token string">"$start_time"</span> \  <span class="token operator">-</span><span class="token operator">-</span>variable end_time<span class="token operator">=</span><span class="token string">"$end_time"</span> \  <span class="token operator">></span><span class="token operator">></span> $<span class="token punctuation">&#123;</span>LOG_FILE<span class="token punctuation">&#125;</span> <span class="token number">2</span><span class="token operator">></span>&amp;<span class="token number">1</span>echo <span class="token string">"[$(date '+%F %T')] 本次同步结束 ✅"</span> | tee <span class="token operator">-</span>a $<span class="token punctuation">&#123;</span>LOG_FILE<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>启动<code>linux</code>的<code>crontab</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">crontab</span> <span class="token parameter variable">-e</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第一次进入需要选择编辑器, 我这里选择的是<code>vim.basic</code></p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token number">0</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> 之前创建的<span class="token keyword">sh</span>的绝对路径<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看是否生效</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">crontab</span> <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>更多crontab配置介绍</p><blockquote><p><a href="https://www.runoob.com/linux/linux-comm-crontab.html">https://www.runoob.com/linux/linux-comm-crontab.html</a></p></blockquote><h2 id="四、常见问题"><a href="#四、常见问题" class="headerlink" title="四、常见问题"></a>四、常见问题</h2><p>如果要迁移，还是在服务器上操作比较好，使用自己的电脑我总是有这有哪的<code>bug</code>,但是一使用服务器, 就顺畅多了</p><p>如果出现的有报错日志</p><p>例如</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">http://xxx.xx.x.x:xxxx/api/_load_error_log?file<span class="token operator">=</span>__shard_14/error_log_insert_stmt_e945c5596d8ba9e3-a98442ef76e69cbc_e945c5596d8ba9e3_a98442ef76e69cbc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这种, 一般是<code>doris</code>的数据类型不一致</p><p>使用<code>curl</code>查看报错信息</p><pre class="line-numbers language-none"><code class="language-none">curl http:&#x2F;&#x2F;xxx.xx.x.x:xxxx&#x2F;api&#x2F;_load_error_log?file&#x3D;__shard_14&#x2F;error_log_insert_stmt_e945c5596d8ba9e3-a98442ef76e69cbc_e945c5596d8ba9e3_a98442ef76e69cbc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后根据报错信息的内容修改<code>doris</code>里数据的类型或长度</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> seaTunnel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人生总是在折腾</title>
      <link href="/2025/04/14/%E5%91%8A%E5%B7%B1/"/>
      <url>/2025/04/14/%E5%91%8A%E5%B7%B1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="保持自我"><a href="#保持自我" class="headerlink" title="保持自我"></a>保持自我</h1><p>他人意见固然重要，但你的本心更甚</p><h1 id="大胆去做"><a href="#大胆去做" class="headerlink" title="大胆去做"></a>大胆去做</h1><p>要么就好好玩，要么就认真学。</p><h1 id="学会接受失败"><a href="#学会接受失败" class="headerlink" title="学会接受失败"></a>学会接受失败</h1><p>写代码人人都能写，那么我们作为科班出身的前路何在</p><h1 id="代办"><a href="#代办" class="headerlink" title="代办"></a>代办</h1><ul><li><p><input disabled="" type="checkbox"> 将之前写的内容导入到这个静态网站</p></li><li><p><input disabled="" type="checkbox"> 把设想的项目实践</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 左岸集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人生，感悟 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
